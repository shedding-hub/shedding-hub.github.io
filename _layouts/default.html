<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ page.title }}</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css">
  <meta property="og:description" content="Data and statistical models for biomarker shedding.">
  <meta property="og:image" content="https://unsplash.com/photos/Ac97OqAWDvg/download?ixid=M3wxMjA3fDB8MXxzZWFyY2h8MTZ8fHdhc3Rld2F0ZXJ8ZW58MHx8fHwxNzI1NTUxODUyfDA&force=true&w=1920">
  <meta property="og:image:width" content="1920">
  <meta property="og:image:height" content="1438">
</head>

<body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/js/all.min.js">
  </script>
  <nav class="navbar">
    <div class="container is-max-desktop">
      <div class="navbar-brand">
        <a class="navbar-item" href="/">
          <span class="subtitle">
            <span class="icon-text">
              <span class="icon has-text-primary">
                <i class="fa-solid fa-poop"></i>
              </span>
              <span>Shedding Hub</span>
            </span>
          </span>
        </a>

        <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
      </div>
      <div id="navMenu" class="navbar-menu">
        <div class="navbar-start">
          <a class="navbar-item" href="/">
            <span class="icon-text">
              <span class="icon">
                <i class="fa-solid fa-home"></i>
              </span>
              <span>Home</span>
            </span>
          </a>
          <a class="navbar-item" href="/datasets.html">
            <span class="icon-text">
              <span class="icon">
                <i class="fa-solid fa-database"></i>
              </span>
              <span>Datasets</span>
            </span>
          </a>
          <a class="navbar-item" href="/vocab/index.html">
            <span class="icon-text">
              <span class="icon">
                <i class="fa-solid fa-language"></i>
              </span>
              <span>Vocabulary</span>
            </span>
          </a>
          <a class="navbar-item" href="/model.html">
            <span class="icon-text">
              <span class="icon">
                <i class="fa-solid fa-chart-line"></i>
              </span>
              <span>Models</span>
            </span>
          </a>
          <a class="navbar-item" href="/package.html">
            <span class="icon-text">
              <span class="icon">
                <i class="fab fa-python"></i>
              </span>
              <span>Package</span>
            </span>
          </a>
          <a class="navbar-item" href="/team.html">
            <span class="icon-text">
              <span class="icon">
                <i class="fa-solid fa-people-group"></i>
              </span>
              <span>Team</span>
            </span>
          </a>
          <a class="navbar-item" href="https://github.com/shedding-hub/shedding-hub" target="_blank" rel="noopener">
            <span class="icon-text">
              <span class="icon">
                <i class="fab fa-github"></i>
              </span>
              <span>GitHub</span>
            </span>
          </a>
          <a class="navbar-item" id="theme-toggle" title="Toggle theme" style="cursor: pointer;">
            <span class="icon-text">
              <span class="icon">
                <i class="fa-solid fa-moon" id="theme-icon"></i>
              </span>
              <span id="theme-text">Dark</span>
            </span>
          </a>
        </div>
      </div>
    </div>
  </nav>

  {{ content }}

  <style>
    /* CSS Variables for Theme System */
    :root {
      /* Light theme colors (default) */
      --bg-primary: #ffffff;
      --bg-secondary: #f5f5f5;
      --bg-tertiary: #fafafa;
      --bg-card: #ffffff;
      --bg-hero: #f5f5f5;
      --bg-section-alt: #f9f9f9;

      --text-primary: #363636;
      --text-secondary: #4a4a4a;
      --text-light: #7a7a7a;
      --text-inverse: #ffffff;

      --border-color: #dbdbdb;
      --border-light: #f0f0f0;

      --primary-color: #485fc7;
      --primary-hover: #3e4eb8;

      --shadow: rgba(10, 10, 10, 0.1);
      --shadow-hover: rgba(10, 10, 10, 0.2);
    }

    [data-theme="dark"] {
      /* Dark theme colors */
      --bg-primary: #1a1a1a;
      --bg-secondary: #242424;
      --bg-tertiary: #2e2e2e;
      --bg-card: #2a2a2a;
      --bg-hero: #1f1f1f;
      --bg-section-alt: #252525;

      --text-primary: #e0e0e0;
      --text-secondary: #b0b0b0;
      --text-light: #909090;
      --text-inverse: #1a1a1a;

      --border-color: #404040;
      --border-light: #353535;

      --primary-color: #6397f8;
      --primary-hover: #4f85e6;

      --shadow: rgba(0, 0, 0, 0.3);
      --shadow-hover: rgba(0, 0, 0, 0.5);
    }

    /* Apply theme variables to global elements */
    body {
      background-color: var(--bg-primary);
      color: var(--text-primary);
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    .hero.is-light {
      background-color: var(--bg-hero) !important;
    }

    .section {
      background-color: var(--bg-primary);
    }

    /* Add subtle background to dataset listing sections for better card contrast */
    #datasets-container {
      padding: 2rem;
      background-color: var(--bg-section-alt);
      border-radius: 6px;
    }

    .has-background-white-ter,
    .has-background-light {
      background-color: var(--bg-section-alt) !important;
    }

    .card {
      background-color: var(--bg-card);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
      box-shadow: 0 0.125em 0.25em rgba(10, 10, 10, 0.05);
      transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
    }

    [data-theme="dark"] .card {
      box-shadow: 0 0.125em 0.25em rgba(0, 0, 0, 0.2);
    }

    .box {
      background-color: var(--bg-card);
      border-color: var(--border-color);
      color: var(--text-primary);
      transition: background-color 0.3s ease, border-color 0.3s ease;
    }

    .navbar {
      background-color: var(--bg-primary);
      border-bottom: 1px solid var(--border-color);
      transition: background-color 0.3s ease, border-color 0.3s ease;
    }

    .navbar-item {
      color: var(--text-primary);
      transition: color 0.3s ease, background-color 0.3s ease;
    }

    .navbar-item:hover {
      background-color: var(--bg-secondary) !important;
    }

    .title,
    .subtitle {
      color: var(--text-primary);
      transition: color 0.3s ease;
    }

    .has-text-dark {
      color: var(--text-primary) !important;
    }

    /* Bulma color helper overrides for dark mode */
    [data-theme="dark"] .has-text-grey {
      color: var(--text-secondary) !important;
    }

    [data-theme="dark"] .notification {
      background-color: var(--bg-card);
      color: var(--text-primary);
    }

    [data-theme="dark"] .button {
      background-color: var(--bg-secondary);
      color: var(--text-primary);
      border-color: var(--border-color);
    }

    [data-theme="dark"] .button.is-primary {
      background-color: var(--primary-color);
      color: white;
    }

    /* Primary background section overrides */
    [data-theme="dark"] .has-background-primary {
      background-color: #2a4a8a !important;
    }

    /* Only apply white text to direct section headings and paragraphs in primary sections, not cards */
    .has-background-primary > .container > .title,
    .has-background-primary > .container > .content > p,
    .has-background-primary .has-text-white {
      color: white !important;
    }

    /* Ensure cards inside primary sections use theme colors */
    .has-background-primary .card .title,
    .has-background-primary .card .subtitle,
    .has-background-primary .card p {
      color: var(--text-primary) !important;
    }

    /* Input and form elements */
    .input,
    .select select {
      background-color: var(--bg-card);
      border-color: var(--border-color);
      color: var(--text-primary);
      transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
    }

    .input:focus,
    .select select:focus {
      border-color: var(--primary-color);
    }

    /* Card hover effect */
    .dataset-card {
      transition: box-shadow 0.2s ease, background-color 0.3s ease;
      background-color: var(--bg-card);
    }

    .dataset-card:hover {
      box-shadow: 0 0.5em 1.5em -0.125em var(--shadow-hover),
                  0 0px 0 1px var(--shadow);
    }

    /* Hide cards when filtering */
    .dataset-card.is-hidden {
      display: none;
    }

    /* Filter controls */
    .filter-controls {
      position: sticky;
      top: 0;
      z-index: 20;
      background: var(--bg-primary);
      padding: 1rem 0;
      margin-bottom: 2rem;
      border-bottom: 1px solid var(--border-color);
      transition: background-color 0.3s ease, border-color 0.3s ease;
    }

    .filter-controls .field.is-horizontal {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      align-items: center;
    }

    .filter-controls .control {
      flex: 0 1 auto;
    }

    .filter-controls .control:first-child {
      flex: 1 1 300px;
    }

    /* Results count styling */
    .filter-controls .help {
      color: var(--text-primary) !important;
      font-size: 1rem !important;
    }

    .filter-controls .help strong {
      color: var(--text-primary) !important;
    }
  </style>

  <script>
    // Separate thousands by a comma if the element has the `separate-thousands` class.
    for (const element of document.getElementsByClassName("separate-thousands")) {
      // Parse the value and don't do anything if the value isn't a number.
      let value = parseFloat(element.textContent);
      if (isNaN(value)) {
        continue;
      }
      // Round if desired.
      let sigfigs = element.getAttribute("data-sigfigs");
      console.log(sigfigs);
      if (sigfigs) {
        value = value.toFixed(parseInt(sigfigs));
      } else {
        value = element.textContent;
      }
      console.log(value);
      // Add the separators.
      let [integralPart, decimalPart] = value.split(".");
      integralPart = integralPart.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      if (decimalPart) {
        element.innerHTML = `${integralPart}.${decimalPart}`;
      } else {
        element.innerHTML = integralPart;
      }
    }

    // Datasets Filter Module
    const DatasetsFilter = {
      init() {
        this.cards = document.querySelectorAll('.dataset-card');
        this.searchInput = document.getElementById('search-input');
        this.biomarkerSelect = document.getElementById('biomarker-filter');
        this.specimenSelect = document.getElementById('specimen-filter');
        this.resultsCount = document.getElementById('results-count');

        this.attachEventListeners();
        this.populateFilterDropdowns();
      },

      attachEventListeners() {
        // Debounced search
        let searchTimeout;
        if (this.searchInput) {
          this.searchInput.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => this.applyFilters(), 300);
          });
        }

        if (this.biomarkerSelect) {
          this.biomarkerSelect.addEventListener('change', () => this.applyFilters());
        }

        if (this.specimenSelect) {
          this.specimenSelect.addEventListener('change', () => this.applyFilters());
        }
      },

      populateFilterDropdowns() {
        const biomarkers = new Set();
        const specimens = new Set();

        this.cards.forEach(card => {
          const biomarkerList = card.dataset.biomarkers?.split(',') || [];
          const specimenList = card.dataset.specimens?.split(',') || [];

          biomarkerList.forEach(b => biomarkers.add(b.trim()));
          specimenList.forEach(s => specimens.add(s.trim()));
        });

        // Populate <select> options
        this.populateSelect(this.biomarkerSelect, Array.from(biomarkers).sort());
        this.populateSelect(this.specimenSelect, Array.from(specimens).sort());
      },

      populateSelect(selectEl, options) {
        if (!selectEl) return;

        options.forEach(opt => {
          if (!opt) return; // Skip empty strings
          const option = document.createElement('option');
          option.value = opt;
          option.textContent = opt;
          selectEl.appendChild(option);
        });
      },

      applyFilters() {
        const searchTerm = this.searchInput?.value.toLowerCase() || '';
        const biomarkerFilter = this.biomarkerSelect?.value || '';
        const specimenFilter = this.specimenSelect?.value || '';

        let visibleCount = 0;

        this.cards.forEach(card => {
          const title = card.querySelector('.title')?.textContent.toLowerCase() || '';
          const description = card.querySelector('.content')?.textContent.toLowerCase() || '';
          const biomarkers = card.dataset.biomarkers?.toLowerCase() || '';
          const specimens = card.dataset.specimens?.toLowerCase() || '';

          // Text search match
          const searchMatch = !searchTerm ||
                             title.includes(searchTerm) ||
                             description.includes(searchTerm);

          // Biomarker filter match
          const biomarkerMatch = !biomarkerFilter ||
                                biomarkers.includes(biomarkerFilter.toLowerCase());

          // Specimen filter match
          const specimenMatch = !specimenFilter ||
                               specimens.includes(specimenFilter.toLowerCase());

          // Show/hide card
          if (searchMatch && biomarkerMatch && specimenMatch) {
            card.classList.remove('is-hidden');
            visibleCount++;
          } else {
            card.classList.add('is-hidden');
          }
        });

        // Update results count
        if (this.resultsCount) {
          this.resultsCount.textContent = visibleCount;
        }
      }
    };

    document.addEventListener('DOMContentLoaded', () => {

      // Get all "navbar-burger" elements
      const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);

      // Add a click event on each of them
      $navbarBurgers.forEach( el => {
        el.addEventListener('click', () => {

          // Get the target from the "data-target" attribute
          const target = el.dataset.target;
          const $target = document.getElementById(target);

          // Toggle the "is-active" class on both the "navbar-burger" and the "navbar-menu"
          el.classList.toggle('is-active');
          $target.classList.toggle('is-active');

        });
      });

      // Initialize new features
      if (document.querySelector('.dataset-card')) {
        DatasetsFilter.init();
      }

    });
  </script>

  <script>
  // Dark theme toggle implementation
  (function() {
    const ThemeManager = {
      STORAGE_KEY: 'shedding-hub-theme',
      THEME_ATTR: 'data-theme',

      init() {
        this.toggleBtn = document.getElementById('theme-toggle');
        this.themeIcon = document.getElementById('theme-icon');
        this.themeText = document.getElementById('theme-text');

        // Load saved theme or detect system preference
        const savedTheme = this.getSavedTheme();
        const systemPreference = this.getSystemPreference();
        const initialTheme = savedTheme || systemPreference;

        this.setTheme(initialTheme, false);
        this.attachListeners();
      },

      getSavedTheme() {
        return localStorage.getItem(this.STORAGE_KEY);
      },

      getSystemPreference() {
        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      },

      setTheme(theme, save = true) {
        const isDark = theme === 'dark';

        // Update DOM
        document.documentElement.setAttribute(this.THEME_ATTR, theme);

        // Update icon and text
        if (this.themeIcon && this.themeText) {
          this.themeIcon.className = isDark ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
          this.themeText.textContent = isDark ? 'Light' : 'Dark';
        }

        // Save to localStorage
        if (save) {
          localStorage.setItem(this.STORAGE_KEY, theme);
        }
      },

      toggleTheme() {
        const currentTheme = document.documentElement.getAttribute(this.THEME_ATTR);
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        this.setTheme(newTheme);
      },

      attachListeners() {
        if (this.toggleBtn) {
          this.toggleBtn.addEventListener('click', (e) => {
            e.preventDefault();
            this.toggleTheme();
          });
        }

        // Listen for system preference changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
          // Only apply if user hasn't set a preference
          if (!this.getSavedTheme()) {
            this.setTheme(e.matches ? 'dark' : 'light', false);
          }
        });
      }
    };

    // Initialize on DOMContentLoaded
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => ThemeManager.init());
    } else {
      ThemeManager.init();
    }
  })();
  </script>
</body>

</html>
