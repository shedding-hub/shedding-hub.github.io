<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ page.title }}</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css">
  <meta property="og:description" content="Data and statistical models for biomarker shedding.">
  <meta property="og:image" content="https://unsplash.com/photos/Ac97OqAWDvg/download?ixid=M3wxMjA3fDB8MXxzZWFyY2h8MTZ8fHdhc3Rld2F0ZXJ8ZW58MHx8fHwxNzI1NTUxODUyfDA&force=true&w=1920">
  <meta property="og:image:width" content="1920">
  <meta property="og:image:height" content="1438">
</head>

<body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/js/all.min.js">
  </script>
  <nav class="navbar">
    <div class="container is-max-desktop">
      <div class="navbar-brand">
        <a class="navbar-item" href="/">
          <span class="subtitle">
            <span class="icon-text">
              <span class="icon has-text-primary">
                <i class="fa-solid fa-poop"></i>
              </span>
              <span>Shedding Hub</span>
            </span>
          </span>
        </a>

        <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
      </div>
      <div id="navMenu" class="navbar-menu">
        <div class="navbar-start">
          <a class="navbar-item" href="/">
            <span class="icon-text">
              <span class="icon">
                <i class="fa-solid fa-home"></i>
              </span>
              <span>Home</span>
            </span>
          </a>
          <a class="navbar-item" href="/datasets.html">
            <span class="icon-text">
              <span class="icon">
                <i class="fa-solid fa-database"></i>
              </span>
              <span>Datasets</span>
            </span>
          </a>
          <a class="navbar-item" href="/model.html">
            <span class="icon-text">
              <span class="icon">
                <i class="fa-solid fa-chart-line"></i>
              </span>
              <span>Models</span>
            </span>
          </a>
          <a class="navbar-item" href="https://pypi.org/project/shedding-hub/" target="_blank" rel="noopener">
            <span class="icon-text">
              <span class="icon">
                <i class="fab fa-python"></i>
              </span>
              <span>Package</span>
            </span>
          </a>
          <a class="navbar-item" href="/team.html">
            <span class="icon-text">
              <span class="icon">
                <i class="fa-solid fa-people-group"></i>
              </span>
              <span>Team</span>
            </span>
          </a>
          <a class="navbar-item" href="/vocab/index.html">
            <span class="icon-text">
              <span class="icon">
                <i class="fa-solid fa-language"></i>
              </span>
              <span>Vocabulary</span>
            </span>
          </a>
          <a class="navbar-item" href="https://github.com/shedding-hub/shedding-hub" target="_blank" rel="noopener">
            <span class="icon-text">
              <span class="icon">
                <i class="fab fa-github"></i>
              </span>
              <span>GitHub</span>
            </span>
          </a>
        </div>
      </div>
    </div>
  </nav>

  {{ content }}

  <style>
    /* Card hover effect */
    .dataset-card {
      transition: box-shadow 0.2s ease;
    }

    .dataset-card:hover {
      box-shadow: 0 0.5em 1.5em -0.125em rgba(10, 10, 10, 0.35),
                  0 0px 0 1px rgba(10, 10, 10, 0.08);
    }

    /* Hide cards when filtering */
    .dataset-card.is-hidden {
      display: none;
    }

    /* Filter controls */
    .filter-controls {
      position: sticky;
      top: 0;
      z-index: 20;
      background: white;
      padding: 1rem 0;
      margin-bottom: 2rem;
      border-bottom: 1px solid #dbdbdb;
    }

    .filter-controls .field.is-horizontal {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      align-items: center;
    }

    .filter-controls .control {
      flex: 0 1 auto;
    }

    .filter-controls .control:first-child {
      flex: 1 1 300px;
    }

    /* Results count styling */
    .filter-controls .help {
      color: #363636 !important;
      font-size: 1rem !important;
    }

    .filter-controls .help strong {
      color: #363636 !important;
    }
  </style>

  <script>
    // Separate thousands by a comma if the element has the `separate-thousands` class.
    for (const element of document.getElementsByClassName("separate-thousands")) {
      // Parse the value and don't do anything if the value isn't a number.
      let value = parseFloat(element.textContent);
      if (isNaN(value)) {
        continue;
      }
      // Round if desired.
      let sigfigs = element.getAttribute("data-sigfigs");
      console.log(sigfigs);
      if (sigfigs) {
        value = value.toFixed(parseInt(sigfigs));
      } else {
        value = element.textContent;
      }
      console.log(value);
      // Add the separators.
      let [integralPart, decimalPart] = value.split(".");
      integralPart = integralPart.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      if (decimalPart) {
        element.innerHTML = `${integralPart}.${decimalPart}`;
      } else {
        element.innerHTML = integralPart;
      }
    }

    // Datasets Filter Module
    const DatasetsFilter = {
      init() {
        this.cards = document.querySelectorAll('.dataset-card');
        this.searchInput = document.getElementById('search-input');
        this.biomarkerSelect = document.getElementById('biomarker-filter');
        this.specimenSelect = document.getElementById('specimen-filter');
        this.resultsCount = document.getElementById('results-count');

        this.attachEventListeners();
        this.populateFilterDropdowns();
      },

      attachEventListeners() {
        // Debounced search
        let searchTimeout;
        if (this.searchInput) {
          this.searchInput.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => this.applyFilters(), 300);
          });
        }

        if (this.biomarkerSelect) {
          this.biomarkerSelect.addEventListener('change', () => this.applyFilters());
        }

        if (this.specimenSelect) {
          this.specimenSelect.addEventListener('change', () => this.applyFilters());
        }
      },

      populateFilterDropdowns() {
        const biomarkers = new Set();
        const specimens = new Set();

        this.cards.forEach(card => {
          const biomarkerList = card.dataset.biomarkers?.split(',') || [];
          const specimenList = card.dataset.specimens?.split(',') || [];

          biomarkerList.forEach(b => biomarkers.add(b.trim()));
          specimenList.forEach(s => specimens.add(s.trim()));
        });

        // Populate <select> options
        this.populateSelect(this.biomarkerSelect, Array.from(biomarkers).sort());
        this.populateSelect(this.specimenSelect, Array.from(specimens).sort());
      },

      populateSelect(selectEl, options) {
        if (!selectEl) return;

        options.forEach(opt => {
          if (!opt) return; // Skip empty strings
          const option = document.createElement('option');
          option.value = opt;
          option.textContent = opt;
          selectEl.appendChild(option);
        });
      },

      applyFilters() {
        const searchTerm = this.searchInput?.value.toLowerCase() || '';
        const biomarkerFilter = this.biomarkerSelect?.value || '';
        const specimenFilter = this.specimenSelect?.value || '';

        let visibleCount = 0;

        this.cards.forEach(card => {
          const title = card.querySelector('.title')?.textContent.toLowerCase() || '';
          const description = card.querySelector('.content')?.textContent.toLowerCase() || '';
          const biomarkers = card.dataset.biomarkers?.toLowerCase() || '';
          const specimens = card.dataset.specimens?.toLowerCase() || '';

          // Text search match
          const searchMatch = !searchTerm ||
                             title.includes(searchTerm) ||
                             description.includes(searchTerm);

          // Biomarker filter match
          const biomarkerMatch = !biomarkerFilter ||
                                biomarkers.includes(biomarkerFilter.toLowerCase());

          // Specimen filter match
          const specimenMatch = !specimenFilter ||
                               specimens.includes(specimenFilter.toLowerCase());

          // Show/hide card
          if (searchMatch && biomarkerMatch && specimenMatch) {
            card.classList.remove('is-hidden');
            visibleCount++;
          } else {
            card.classList.add('is-hidden');
          }
        });

        // Update results count
        if (this.resultsCount) {
          this.resultsCount.textContent = visibleCount;
        }
      }
    };

    document.addEventListener('DOMContentLoaded', () => {

      // Get all "navbar-burger" elements
      const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);

      // Add a click event on each of them
      $navbarBurgers.forEach( el => {
        el.addEventListener('click', () => {

          // Get the target from the "data-target" attribute
          const target = el.dataset.target;
          const $target = document.getElementById(target);

          // Toggle the "is-active" class on both the "navbar-burger" and the "navbar-menu"
          el.classList.toggle('is-active');
          $target.classList.toggle('is-active');

        });
      });

      // Initialize new features
      if (document.querySelector('.dataset-card')) {
        DatasetsFilter.init();
      }

    });
  </script>
</body>

</html>
